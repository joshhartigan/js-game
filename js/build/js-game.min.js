var arrayContains=function(a,b){return a.some(function(a){return a.toString()==b.toString()})},subArrayIndex=function(a,b){for(var c=0;c<a.length;c++)if(a[c].toString()==b.toString())return c;return-1},MONSTER_COUNT=Math.floor(10*Math.random())+5,monsters,attack=function(){var a=arrayContains(monsters,[xPos,yPos-charHeight]),b=arrayContains(monsters,[xPos,yPos+charHeight]),c=arrayContains(monsters,[xPos-charWidth,yPos]),d=arrayContains(monsters,[xPos+charWidth,yPos]),e=new Audio("assets/hit.wav");(a||b||c||d)&&(points+=1,ctx.fillStyle="#F00",e.play()),a&&(monsterIndex=subArrayIndex(monsters,[xPos,yPos-charHeight]),monsters.splice(monsterIndex,1),ctx.fillText("|",xPos,yPos-charHeight)),b&&(monsterIndex=subArrayIndex(monsters,[xPos,yPos+charHeight]),monsters.splice(monsterIndex,1),ctx.fillText("|",xPos,yPos+charHeight)),c&&(monsterIndex=subArrayIndex(monsters,[xPos-charWidth,yPos]),monsters.splice(monsterIndex,1),ctx.fillText("-",xPos-charWidth,yPos)),d&&(monsterIndex=subArrayIndex(monsters,[xPos+charWidth,yPos]),monsters.splice(monsterIndex,1),ctx.fillText("-",xPos+charWidth,yPos))},createMonsters=function(){positions=[];for(var a=0;MONSTER_COUNT>a;a++){var b=(Math.floor(50*Math.random()/1)+1)*charWidth,c=(Math.floor(33*Math.random()/1)+1)*charHeight;console.log("created monster at",b,c),positions.push([b,c])}return positions},drawMonsters=function(a){ctx.fillStyle="#BADA55";for(var b=0;b<a.length;b++)ctx.fillText("m",a[b][0],a[b][1])},canvas=document.getElementById("game-canvas"),ctx=canvas.getContext("2d"),loop,WIDTH=500,HEIGHT=500,xPos=0,yPos=15,charWidth=10,charHeight=15,MAX_PLAYER_X=WIDTH/charWidth*charWidth-charWidth,MAX_PLAYER_Y=33*charHeight,points=0,updatesSinceLastTick=0;document.onkeypress=function(a){a=a||window.event;var b=a.keyCode||a.which,c=[119,107,115,106,97,104,100,108,112];c.indexOf(b)>=0&&movePlayer(b),117==b&&attack()};var movePlayer=function(a){var b=arrayContains(monsters,[xPos,yPos-charHeight]),c=arrayContains(monsters,[xPos,yPos+charHeight]),d=arrayContains(monsters,[xPos-charWidth,yPos]),e=arrayContains(monsters,[xPos+charWidth,yPos]);(119==a||107==a)&&yPos>charHeight&&!b&&(yPos-=charHeight),(115==a||106==a)&&MAX_PLAYER_Y>yPos&&!c&&(yPos+=charHeight),(97==a||104==a)&&xPos>0&&!d&&(xPos-=charWidth),(100==a||108==a)&&MAX_PLAYER_X>xPos&&!e&&(xPos+=charWidth),112==a&&(console.log(monsters),console.log(xPos,yPos))},start=function(){"undefined"!=typeof loop&&clearInterval(loop),loop=setInterval(update,60),ctx.font="20px inconsolata",monsters=createMonsters()},update=function(){draw(),checkForWin(),updatesSinceLastTick+=1,5==updatesSinceLastTick&&(updatesSinceLastTick=0,tick())},draw=function(){ctx.fillStyle="#292724",ctx.fillRect(0,0,WIDTH,HEIGHT),ctx.fillStyle="#DEC335",ctx.fillText("@",xPos,yPos),drawMonsters(monsters)},tick=function(){for(var a=0;a<monsters.length;a++){var b=Math.random();.3>b&&monsters[a][0]<MAX_PLAYER_X?monsters[a][0]+=charWidth:.5>b&&monsters[a][0]>0&&(monsters[a][0]-=charWidth);var c=Math.random();.3>c&&monsters[a][1]<MAX_PLAYER_Y?monsters[a][1]+=charHeight:.5>b&&monsters[a][1]>charHeight&&(monsters[a][1]-=charHeight)}},checkForWin=function(){if(points==MONSTER_COUNT){ctx.fillStyle="#292724",ctx.fillRect(0,0,WIDTH,HEIGHT);var a=new Audio("assets/win.wav");a.play(),clearInterval(loop),document.getElementById("win-message").style.display="block"}};start();